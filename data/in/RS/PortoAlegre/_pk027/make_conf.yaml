pkid:      27
pkversion: 1
schemaId_input:    ref027a  # ID do JSON-schema de input, ref no preimeiro template a usar este padrão de input.
schemaId_template: ref027a  # ID do makefile.mustache, ref no preimeiro package a usar o template.
thisTplFile_root: digital-preservation-BR
need_commands:    7z psql shp2pgsql
srid: 31982
files:
  -
    p:    1
    file: 51a6beb9fca43e0fb45727138982f7806b8df52fce53f5e0e31edd61bfbc21b9.rar
    name: Lotes
  -
    p:    2
    file: f4d3819f9853e85e43bf7a58de7f257eed5f63bcf36daed1c4db0f2701544adc.zip
    name: Eixos
  -
    p:    3
    file: 9600dcba403c8dc0b066c8f429507e4672966a01c93119923f75361a6ebc64c0.zip
    name: Bairros
  -
    p:    4
    file: 9600dcba403c8dc0b066c8f429507e4672966a01c93119923f75361a6ebc64c0.zip
    name: Quadras

parts:

  geoaddress_none: # config própria desse template, em sao paulo seria array
        p: 1a   # identifcador do layer, pode ter mais de um por file
        file: 1
        tabname:  geoaddress
        sql_select: ['gid', 'textstring as house_number', 'setor', 'last_edi_1 as dateModified', 'geom']
        orig_filename: NRO_IMOVEL  # incluir numa pasta isolada todos os NRO_IMOVEL

  nsvia_full:
        p: 2a
        file: 2
        tabname:  namespace
        query_view: |-
          CREATE VIEW vw_$(tabname) AS \
            SELECT row_number() OVER () as gid, * \
            FROM ( \
              SELECT upper(trim(nome)) as nome, count(*) n, round(sum(st_area(geom))) area, \
                     max(data_edica) dateModified, ST_UNION(geom) as geom \
              FROM $(tabname)\
              GROUP BY 1 ORDER BY 1 \
            ) t
        orig_filename: Bairros_LC12112_16

  via_full:
        p: 3a
        file: 3
        tabname:  via
        query_view: |-
          CREATE VIEW vw_$(tabname) AS \
            SELECT gid, CDIDECAT || iif(NMIDEPRE>'',' ' || NMIDEPRE,''::text) || ' ' || NMIDELOG AS via_name,\
                   NRIMPINI, NRIMPFIN, NRPARINI, NRPARFIN, geom \
            FROM $(tabname)
        orig_filename: EixosLogradouros
